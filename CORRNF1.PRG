SET TALK OFF
SET STATUS ON
*------ Cria a tabela de Notas Fiscais Agrupadas
SELECT CGC, NNF, DEMI, SUM(VAL), SUM(IPI), SUM(ICM), CANCELNF,;
       ENT, TRA, PED, TIP, CP1, CP2, CP3, CP4, PE1, PE2, PE3, PE4;
       FROM CADNF;
       GROUP BY NNF;
       ORDER BY NNF;
       INTO TABLE WORK
CLOSE ALL
*------ Corrige a Tabela CABECNF
SELE 0
USE WORK 
INDEX ON NNF TO WORK

SELE 0
USE CABECNF 

GO TOP
DO WHILE ! EOF()
  IF SEEK( NNF, 'WORK' )
    REPLACE CGC       WITH WORK->CGC
    REPLACE DEMISSAO  WITH CTOD(WORK->DEMI)
    REPLACE VALPROD   WITH WORK->SUM_VAL
    REPLACE VALIPI    WITH WORK->SUM_IPI
    REPLACE VALICM    WITH WORK->SUM_ICM
    REPLACE CANCELADA WITH ! EMPTY(WORK->CANCELNF)
    REPLACE DTCANCEL  WITH CTOD(WORK->CANCELNF)
    REPLACE DTENTREG  WITH CTOD(WORK->ENT)
    REPLACE TRA       WITH WORK->TRA
    REPLACE PED       WITH WORK->PED
    REPLACE TIPNF     WITH WORK->TIP
    REPLACE CP1       WITH WORK->CP1
    REPLACE CP2       WITH WORK->CP2
    REPLACE CP3       WITH WORK->CP3
    REPLACE CP4       WITH WORK->CP4
    REPLACE PE1       WITH WORK->PE1
    REPLACE PE2       WITH WORK->PE2            
    REPLACE PE3       WITH WORK->PE3
    REPLACE PE4       WITH WORK->PE4
  ENDIF  
  SKIP
ENDDO
CLOSE ALL
SET TALK ON
SET STATUS ON
