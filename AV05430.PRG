* AV05600 - RELATORIO DOS PRODUTOS EMBARCADOS NO DIA ANTERIOR
* SISTEMA ADMINISTRACAO DE VENDAS
* ADAO ELI PEREIRA
*
DO TESTIMP2
  IF CP = 'N'
    RETURN
  ENDIF
*
CLOS DATA
? MENSAG('Preparando os Arquivos... Aguarde')
*
SELE D
  USE PROD INDEX PROD
SELE B
  USE CADNFD
  ZAP
SELE A
  USE CADNF
*
DO WHILE !EOF()
  IF ENT = SPACE(8) .OR. DEV = 'S'
    SKIP
    LOOP
  ELSE
    MREF = REF
    MQTD = QTD
    MDES = DES
    MNNF = NNF
      REPL DEV WITH 'S'
        SELE D
          SEEK MREF
            MCCL = CCL
            MUNI = UNI
        SELE B
          APPE BLAN
            REPL REF WITH MREF,QTD WITH MQTD,CCL WITH MCCL
            REPL DES WITH MDES,NDOC WITH MNNF,UNI WITH MUNI
      SELE A
        SKIP
        LOOP
  ENDIF
ENDDO
*
CLOS DATA
USE CADNFD
  INDEX ON REF + STR(NDOC,6) TO CADNFD
CLOS DATA
*
MREF   = SPACE(04)
MQTD   = 0
PAGCTR = 0
QTDTOT = 0.00
TAMREL = 2
*
USE CADNFD INDEX CADNFD
*
? MENSAG('Imprimindo Produtos Faturados e embarcados... Aguarde')
*
DO DEFSAIDA

DO WHILE .NOT. EOF()
  ? CABEC('AV05600','PRODUTOS FATURADOS E EMBARCADOS',131)
  @ 4,01 SAY 'REFERENCIA'
  @ 4,06 SAY 'DESCRICAO DO PRODUTO'
  @ 4,54 SAY 'UN'
  @ 4,58 SAY 'CLAS.FISC'
  @ 4,70 SAY 'N.FISC'
  @ 4,80 SAY 'QUANTIDADE'
  @ 4,92 SAY 'QTD ACUMUL'
  @ 5,1 SAY REPLICATE('-',131)
*
  LIN = 6
  DO WHILE !(EOF() .OR. BOF()) .AND. LIN < 58
    @ LIN,01 SAY REF
      MREF = REF
    @ LIN,06 SAY SUBS(DES,1,48)
    @ LIN,54 SAY UNI
    @ LIN,58 SAY CCL
    @ LIN,70 SAY NDOC
    @ LIN,78 SAY QTD PICT '9,999,999.99'
      STOR (QTD + QTDTOT) TO QTDTOT
      SKIP
        IF REF <> MREF .OR. EOF()
          @ LIN,90 SAY QTDTOT PICT '9,999,999.99'
            STOR 0.00 TO QTDTOT
        ENDIF
          LIN = LIN + 1
          IF  EOF()
            @ LIN,1 SAY REPLICATE('-',131)
            @ LIN+1,10 SAY 'F I N A L    D E S T E    R E L A T O R I O'
          ENDIF
  ENDDO
ENDDO

DO IMPSAIDA

RETURN
