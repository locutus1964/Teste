CLEAR
CLOSE ALL
SET TALK OFF
SET SAFETY OFF

USE ITEMCONJ
COPY STRU EXTE TO TMP
USE TMP
INDEX ON field_name tag NAME

IF ! SEEK('NITEM', 'TMP')
  ? 'Atualizando...'
  APPEND BLANK
  REPLACE FIELD_NAME WITH 'NITEM'
  REPLACE FIELD_TYPE WITH 'N'
  REPLACE FIELD_LEN  WITH 2
  REPLACE FIELD_DEC  WITH 0
  USE
  CREATE NOVO FROM TMP
  SELE 0
  USE TMP
  SELE 0
  USE ITEMCONJ 
  GO TOP
  DO WHILE ! EOF()
    SELE NOVO 
    APPEND BLANK
    SELE TMP
    GO TOP
    DO WHILE ! EOF()
      ORIGEM  = 'ITEMCONJ->' + FIELD_NAME
      DESTINO = 'NOVO->' + FIELD_NAME   
      IF FIELD_NAME <> 'NITEM'
        REPLACE &DESTINO WITH &ORIGEM
      ENDIF  
      SELE TMP
      SKIP
    ENDDO 
    SELE ITEMCONJ
    SKIP
  ENDDO
  
ENDIF  

CLOSE ALL
? 'Copiando para um novo arquivo...'

COPY FILE NOVO.DBF TO ITEMCONJ.DBF

? 'Numerando...'
USE ITEMCONJ 
INDEX ON CONJ+STR(NITEM) TAG PRIMX
INDEX ON CONJ TAG CONJX
SET ORDER TO CONJX
GO TOP
DO WHILE ! EOF()
  MCONJ = CONJ  
  I = 1
  DO WHILE ! EOF() .AND. MCONJ = CONJ
    REPLACE NITEM WITH I
    i = i + 1
    SKIP
  ENDDO
ENDDO    

DO CRIACDX

SET TALK ON
CLOSE ALL
