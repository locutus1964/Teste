* AV10500 - CALCULO E IMPRESSAO DOS VALORES RECEBIDOS NO MES POR CLIENTE
* SISTEMA ADMINISTRACAO DE EMPRESAS
* ADAO ELI PEREIRA - 02-12-92
*
DO TESTIMP2
  IF CP = 'N'
    RETURN
  ENDIF

MMES   = SPACE(5)
MMOEDA = 0
? CABTELA(0,0,24,79)
MENS = 'Valores recebidos por Cliente'
? MENSAGR(MENS)
@ 01,POS SAY MENS

 @ 10,20 SAY "Data Inicial :"
 @ 12,20 SAY "Data Final :"
 DTINI = SPACE(08)
 DTFIM = SPACE(08)

 @ 10,40 GET DTINI PICTURE "99/99/99"
 @ 12,40 GET DTFIM PICTURE "99/99/99"
   READ

 MENS = DADCORR
 DO PEGRESP WITH [SN]
   IF MC = 'N'
     RETURN
   ENDIF
     
 * PREPARACAO DO ARQUIVO COM DUPLICATAS E VENCIMENTOS
 ? MENSAG('Classificando duplicatas para emissao do relatorio...Aguarde')

 USE DUPL
   COPY TO CADWORK1 FOR PAG >= CTOD(DTINI) .AND. PAG ;
   <= CTOD(DTFIM) 
   
*  USE DUPL
*    COPY TO CADWORK1 FOR SUBS(PAG,4,5) = MMES .AND. EMPTY(DTCANCEL)

  MENS= 'Classificando valores recebidos por Cliente... Aguarde'
  ? MENSAGR(MENS)
  @ 14,POS SAY MENS
*
  USE CADWORK1
    INDEX ON SUBS(PAG,7,2)+'/'+SUBS(PAG,4,2)+'/'+SUBS(PAG,1,2) + CGC + STR(NDUP,6) TO CADWORK1
  CLOS DATA
*
  ? MENSAG('Imprimindo Relatorio... Aguarde')
*
  PAGCTR = 0
  TAMREL = 2
*
SELE 0
  USE CADMOEDA INDEX CADMOEDA
SELE 0
  USE CLIEN ORDER P_CGC
SELE 0
  USE CADWORK1 INDEX CADWORK1
*
TVDP    = 0.00
GVDP    = 0.00
TJUROS  = 0.00
GJUROS  = 0.00
TDESC   = 0.00
GDESC   = 0.00
TVALDEV = 0.00
GVALDEV = 0.00
TITULO = 'VALORES RECEBIDOS POR CLIENTE DE - '+DTINI+' ATE '+DTFIM
MCGC   = SPACE(16)
*
SELE CADWORK1

DO DEFSAIDA

DO WHILE .NOT. EOF()
  ? CABEC('AV10500',TITULO,132)
  @ 03,001 SAY 'NOME DE GUERRA  UF REGIAO VEND'
  @ 03,034 SAY 'DUP/PARC'
  @ 03,044 SAY ' VENCTO'
  @ 03,054 SAY 'DT PAGTO'
  @ 03,064 SAY 'ATR'
  @ 03,069 SAY 'VALOR DUPLICAT'
  @ 03,086 SAY 'VALOR JUROS'
  @ 03,101 SAY 'VALOR DESCTO'
  @ 03,117 SAY 'LIQ.RECEBIDO'
  @ 04,001 SAY REPLICATE('-',132)

  LIN = 5
*
  DO WHILE .NOT. EOF() .AND. LIN < 64
    SELE CADWORK1

      IF CGC <> MCGC
        CCGC = CGC
        SELE CLIEN
          SEEK CCGC
            IF !(EOF() .OR. BOF())
              @ LIN,01 SAY GUE
              @ LIN,17 SAY EST
              @ LIN,20 SAY FmtRegiao(REGIAO,IDREGIAO)
              @ LIN,27 SAY VEN
            ELSE
              @ LIN,01 SAY 'CLIENTE NAO CADASTRADO'
            ENDIF
          MCGC = CGC
      ENDIF

    SELE CADWORK1
      @ LIN,34 SAY NDUP PICT '999999'
      @ LIN,40 SAY '/'
      @ LIN,41 SAY PDUP PICT '9'
      @ LIN,44 SAY VENC
      @ LIN,54 SAY PAG
      @ LIN,64 SAY PAG - VENC PICT '999'
      MVDP = VDP
      MPAG = PAG
      @ LIN,69 SAY MVDP PICT '9,999,999,999.99'
        TVDP = (TVDP + MVDP)
        GVDP = (GVDP + MVDP)
      @ LIN,86 SAY JUROS PICT '999,999,999.99'
        TJUROS = (TJUROS + JUROS)
        GJUROS = (GJUROS + JUROS)
      @ LIN,101 SAY DESC PICT '999,999,999.99'
        TDESC = (TDESC + DESC)
        GDESC = (GDESC + DESC)
      @ LIN,117 SAY (MVDP + JUROS - DESC) PICT '9,999,999,999.99'

      LIN = LIN + 1

      SKIP

        IF PAG <> MPAG .OR. EOF()
          @ LIN,10 SAY 'TOTAIS DO DIA'
          @ LIN,68 SAY TVDP PICT '99,999,999,999.99'
          @ LIN,84 SAY TJUROS PICT '9,999,999,999.99'
          @ LIN,101 SAY TDESC PICT '999,999,999.99'
          @ LIN,116 SAY (TVDP + TJUROS - TDESC) PICT '99,999,999,999.99'
          TVDP  =  0.00
          TJUROS  = 0.00
          TDESC = 0.00
          LIN = LIN + 1
          @ LIN,001 SAY REPLICATE('-',132)
          LIN = LIN + 1
        ENDIF

        IF EOF()
          @ LIN,10 SAY 'TOTAIS DOS RECEBIMENTOS'
          @ LIN,68 SAY GVDP PICT '99,999,999,999.99'
          @ LIN,84 SAY GJUROS PICT '99,999,999,999.99'
          @ LIN,101 SAY GDESC PICT '999,999,999.99'
          @ LIN,116 SAY (GVDP + GJUROS - GDESC) PICT '99,999,999,999.99'
        ENDIF

  ENDDO
ENDDO

DO IMPSAIDA
RETURN
